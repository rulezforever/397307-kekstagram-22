(()=>{"use strict";const e="Escape",t=e=>e.classList.remove("hidden"),n=e=>e.classList.add("hidden"),r=(e,t,n)=>{e.key===t&&(e.preventDefault(),n())},o=document.querySelector(".social__comments"),c=document.querySelector(".social__comments-loader"),s=()=>{const e=o.querySelectorAll(".visually-hidden");Array.from(e).slice(0,5).forEach((e=>{e.classList.remove("visually-hidden")})),0===o.querySelectorAll("li.visually-hidden").length?n(c):t(c)},l=document.querySelector(".big-picture"),i=document.body,a=document.querySelector(".comments-loader"),d=l.querySelector(".big-picture__cancel"),u=l.querySelector(".social__comment-count"),m=l.querySelector(".comments-count"),v=l.querySelector(".social__comments"),y=()=>{const e=v.querySelectorAll("li:not(.visually-hidden)"),t=v.querySelectorAll("li");u.textContent=`${e.length} из ${t.length} комментариев`},p=e=>{const n=l.querySelector(".likes-count");i.classList.add("modal-open"),l.querySelector(".big-picture__img img").src=e.url,n.textContent=e.likes,m.textContent=e.comments.length,l.querySelector(".social__caption").textContent=e.description,(e=>{o.innerHTML="";const t=document.createDocumentFragment();e.comments.forEach((e=>{t.appendChild((e=>{const t=document.createElement("li");t.className="social__comment visually-hidden";const n=document.createElement("img");n.className="social__picture",n.src=e.avatar,n.alt=e.name,n.width="35",n.height="35";const r=document.createElement("p");return r.className="social__text",r.innerHTML=e.message,t.append(n),t.append(r),t})(e))})),o.appendChild(t)})(e),s(),y(),t(l),d.addEventListener("click",S),document.addEventListener("keydown",E)},S=()=>{n(l),d.removeEventListener("click",S),i.classList.remove("modal-open"),document.removeEventListener("keydown",E)};a.addEventListener("click",(()=>{s(),y()}));const E=t=>{r(t,e,S)},g=document.querySelector(".pictures"),h=document.querySelector("#picture").content.querySelector(".picture"),L=e=>{const t=document.createDocumentFragment();e.forEach((e=>{t.appendChild((e=>{const t=h.cloneNode(!0);return t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.addEventListener("click",(t=>{t.preventDefault(),p(e)})),t})(e))})),document.querySelectorAll(".picture").forEach((e=>e.remove())),g.appendChild(t)},f=document.querySelector(".effect-level__slider"),q=document.querySelector(".effect-level__value");f.classList.add("visually-hidden"),q.value=80,noUiSlider.create(f,{range:{min:0,max:100},start:80,step:1,connect:"lower"});const A={chrome:{NAME:"chrome",RANGE_MIN:0,RANGE_MAX:1,START:1,STEP:.1,UNITS:""},sepia:{NAME:"sepia",RANGE_MIN:0,RANGE_MAX:1,START:1,STEP:.1,UNITS:""},marvin:{NAME:"marvin",RANGE_MIN:0,RANGE_MAX:100,START:100,STEP:1,UNITS:"%"},phobos:{NAME:"phobos",RANGE_MIN:0,RANGE_MAX:3,START:3,STEP:.1,UNITS:"px"},heat:{NAME:"heat",RANGE_MIN:1,RANGE_MAX:3,START:3,STEP:.1,UNITS:""},none:{NAME:"none",RANGE_MIN:0,RANGE_MAX:1,START:1,STEP:1,UNITS:""}},N=document.querySelector(".img-upload__preview"),k=document.querySelector(".effects__list"),T=()=>{switch(b){case"chrome":N.style.filter=`grayscale(${q.value})`;break;case"sepia":N.style.filter=`sepia(${q.value})`;break;case"marvin":N.style.filter=`invert(${q.value}${A.marvin.UNITS})`;break;case"phobos":N.style.filter=`blur(${q.value}${A.phobos.UNITS})`;break;case"heat":N.style.filter=`brightness(${q.value})`}};let b="";const C=e=>{if(!e.target.matches('input[type="radio"]'))return;b=e.target.value,N.className="effects__preview--"+b,N.classList.add("img-upload__preview"),f.classList.add("visually-hidden"),N.style.filter="none","none"!==b&&(f.classList.remove("visually-hidden"),N.classList.add("effects__preview--"+b));const t=A[b];T(),f.noUiSlider.updateOptions({range:{min:t.RANGE_MIN,max:t.RANGE_MAX},start:t.START,step:t.STEP})};f.noUiSlider.on("update",((e,t)=>{q.value=e[t],T()}));const M="100%",w=new Map;w.STEP=25,w.MIN=25,w.DEFAULT=100,w.MAX=100;const R=document.querySelector(".scale__control--value"),x=document.querySelector(".scale__control--smaller"),I=document.querySelector(".scale__control--bigger");R.value=M;const $=e=>{const t=parseInt(R.value),n="decrease"===e?t-w.STEP:t+w.STEP;n>=w.MIN&&n<=w.MAX&&(e=>{R.value=`${e}%`;const t=(parseInt(e)/100).toFixed(2);N.style.transform=`scale(${t})`})(n)};x.addEventListener("click",(()=>$("decrease"))),I.addEventListener("click",(()=>$("increase")));const G="https://22.javascript.pages.academy/kekstagram",U=document.querySelector("#success").content.querySelector(".success"),P=document.querySelector("#error").content.querySelector(".error"),V=document.querySelector("main"),D=t=>{r(t,e,j)},X=t=>{r(t,e,O)},F=e=>{e.target===document.querySelector(".success")&&j(),e.target===document.querySelector(".error")&&O()},j=()=>{document.querySelector(".success__button").removeEventListener("click",j),document.removeEventListener("keydown",D),document.removeEventListener("click",F),document.querySelector(".success").remove()},z=()=>{V.appendChild((()=>{const e=U.cloneNode(!0),t=document.createDocumentFragment();return t.appendChild(e),t})()),document.querySelector(".success__button").addEventListener("click",j),re(),document.addEventListener("keydown",D),document.addEventListener("click",F)},O=()=>{document.querySelector(".error__button").removeEventListener("click",O),document.removeEventListener("keydown",X),document.removeEventListener("click",F),document.querySelector(".error").remove()},H=()=>{V.appendChild((()=>{const e=P.cloneNode(!0),t=document.createDocumentFragment();return t.appendChild(e),t})()),document.querySelector(".error__button").addEventListener("click",O),re(),document.addEventListener("keydown",X),document.addEventListener("click",F)},W=document.querySelector(".img-upload__form"),Z=W.querySelector(".text__hashtags"),B=/^[0-9A-Za-zА-Яа-я]+$/,J=W.querySelector(".text__description");Z.addEventListener("input",(()=>{const e=Z.value.trim().toLowerCase().split(" ");e.length>5?Z.setCustomValidity("нельзя указать больше пяти хэш-тегов"):(e.some((t=>{"#"!==t[0]?Z.setCustomValidity("хэш-тег должен начинаться с символа # (решётка)"):t.length<2?Z.setCustomValidity("хеш-тег не может состоять только из одной решётки"):B.test(t.slice(1))?t.length>20?Z.setCustomValidity("максимальная длина одного хэш-тега 20 символов, включая решётку"):t.indexOf("#",1)>=1?Z.setCustomValidity("хэш-теги разделяются пробелами"):e.length!==new Set(e).size?Z.setCustomValidity("один и тот же хэш-тег не может быть использован дважды"):Z.setCustomValidity(""):Z.setCustomValidity("строка после решётки должна состоять из букв и чисел и не может содержать пробелы, спецсимволы (#, @, $ и т. п.), символы пунктуации (тире, дефис, запятая и т. п.), эмодзи и т. д.")})),Z.reportValidity())})),J.addEventListener("input",(()=>{J.value.length>140?J.setCustomValidity("длина комментария не может составлять больше 140 символов"):(J.setCustomValidity(""),J.reportValidity())}));const K=e=>{e.stopPropagation()};Z.addEventListener("keydown",K),J.addEventListener("keydown",K);const Q=["gif","jpg","jpeg","png"],Y=document.querySelector(".img-upload__img"),ee=document.querySelector("#upload-file"),te=document.querySelector(".img-upload__overlay"),ne=document.querySelector("#upload-cancel"),re=()=>{n(te),i.classList.remove("modal-open"),ee.value="",document.removeEventListener("keydown",oe),ne.removeEventListener("click",re),k.removeEventListener("change",C),Z.removeEventListener("keydown",K),J.removeEventListener("keydown",K),N.className="img-upload__preview",N.style.filter="none",R.value=M,N.style.transform="none",f.classList.add("visually-hidden"),Z.value="",J.value=""},oe=t=>{r(t,e,re)};ee.addEventListener("change",(()=>{k.addEventListener("change",C),document.addEventListener("keydown",oe),ne.addEventListener("click",re),t(te),i.classList.add("modal-open");const e=ee.files[0],n=e.name.toLowerCase();if(Q.some((e=>n.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{Y.src=t.result})),t.readAsDataURL(e)}}));const ce=document.querySelector(".img-filters"),se=document.querySelector(".img-filters__form"),le=e=>e.slice(),ie=e=>_.shuffle(e).slice(0,10),ae=e=>e.slice().sort(((e,t)=>t.comments.length-e.comments.length));var de;de=e=>{L(e),(e=>{ce.classList.remove("img-filters--inactive"),se.addEventListener("click",(t=>{((e,t)=>{if(!e.target.classList.contains("img-filters__button"))return;let n=e.target.parentElement.querySelector(".img-filters__button--active");var r;n&&n.classList.remove("img-filters__button--active"),e.target.classList.add("img-filters__button--active"),_.debounce(L,500)({"filter-default":le(r=t),"filter-random":ie(r),"filter-discussed":ae(r)}[se.querySelector(".img-filters__button--active").id])})(t,e)}))})(e)},fetch(`${G}/data`).then((e=>e.json())).catch((e=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})(e)})).then((e=>{de(e)})),W.addEventListener("submit",(e=>{var t,n,r;e.preventDefault(),t=z,n=H,r=new FormData(e.target),fetch(`${G}`,{method:"POST",body:r}).then((e=>{e.ok?t():n()})).catch((()=>{n()}))}))})();
//# sourceMappingURL=main.bundle.js.map